<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Boulder Tracker</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="firebase-config.js"></script>
  <style>
    body { margin: 0; font-family: 'Inter', system-ui, -apple-system, sans-serif; }
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .secondary-text { font-size: 0.75rem; line-height: 1.1; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useMemo, useRef } = React;
    const CLOUD_DOC_PATH = 'boulder-tracker/shared';
    const FIREBASE_CONFIG = window.FIREBASE_CONFIG || null;

    const MBP_GRADES = [
      { grade: 'V0', color: '#F4E03C', textColor: '#000', value: 0 },
      { grade: 'V0-V2', color: '#DC143C', textColor: '#fff', value: 1 },
      { grade: 'V1-V3', color: '#2D5D3B', textColor: '#fff', value: 2 },
      { grade: 'V2-V4', color: '#4A148C', textColor: '#fff', value: 3 },
      { grade: 'V3-V5', color: '#D2691E', textColor: '#fff', value: 4 },
      { grade: 'V4-V6', color: '#000000', textColor: '#fff', value: 5 },
      { grade: 'V5-V7', color: '#1E90FF', textColor: '#fff', value: 6 },
      { grade: 'V6-V8', color: '#C71585', textColor: '#fff', value: 7 },
      { grade: 'V8-V10+', color: '#FFFFFF', textColor: '#000', value: 8 }
    ];

    const SimpleBarChart = ({ data, dataKey, secondaryKey, xKey, colors, height = 250 }) => {
      if (!data || data.length === 0) return null;
      const maxValue = Math.max(...data.map(d => Math.max(Number(d[dataKey]) || 0, Number(d[secondaryKey]) || 0)), 1);
      const chartWidth = Math.max(data.length * 70 + 60, 300);
      return (
        <div style={{ height, width: '100%', overflowX: 'auto' }}>
          <svg width={chartWidth} height={height}>
            <line x1="45" y1="20" x2="45" y2={height - 40} stroke="#475569" />
            <line x1="45" y1={height - 40} x2={chartWidth - 10} y2={height - 40} stroke="#475569" />
            {data.map((item, i) => {
              const val1 = Number(item[dataKey]) || 0;
              const val2 = secondaryKey ? (Number(item[secondaryKey]) || 0) : 0;
              const barHeight1 = (val1 / maxValue) * (height - 80);
              const barHeight2 = secondaryKey ? (val2 / maxValue) * (height - 80) : 0;
              const x = 55 + i * 65;
              return (
                <g key={i}>
                  <rect x={x} y={height - 40 - barHeight1} width={secondaryKey ? 25 : 45} height={Math.max(barHeight1, 0)} fill={colors[0]} rx="3" />
                  {secondaryKey && <rect x={x + 27} y={height - 40 - barHeight2} width={25} height={Math.max(barHeight2, 0)} fill={colors[1]} rx="3" />}
                  <text x={x + (secondaryKey ? 26 : 22)} y={height - 20} textAnchor="middle" fill="#94a3b8" fontSize="11">{item[xKey]}</text>
                  {val1 > 0 && <text x={x + (secondaryKey ? 13 : 22)} y={height - 45 - barHeight1} textAnchor="middle" fill="#f1f5f9" fontSize="11">{val1}</text>}
                </g>
              );
            })}
          </svg>
          {secondaryKey && (
            <div className="flex gap-4 justify-center mt-2 text-sm">
              <span className="flex items-center gap-1"><span className="w-3 h-3 rounded" style={{ backgroundColor: colors[0] }}></span>{dataKey}</span>
              <span className="flex items-center gap-1"><span className="w-3 h-3 rounded" style={{ backgroundColor: colors[1] }}></span>{secondaryKey}</span>
            </div>
          )}
        </div>
      );
    };

    const SimplePieChart = ({ data, nameKey, valueKey }) => {
      if (!data || data.length === 0) return null;
      const total = data.reduce((sum, d) => sum + (d[valueKey] || 0), 0);
      if (total === 0) return <div className="text-center text-slate-400 secondary-text">No data</div>;
      let currentAngle = -Math.PI / 2;
      const size = 220, cx = size / 2, cy = size / 2, radius = 80;
      const polarToCartesian = (angle) => ({ x: cx + radius * Math.cos(angle), y: cy + radius * Math.sin(angle) });
      const describeArc = (startAngle, endAngle) => {
        const start = polarToCartesian(startAngle), end = polarToCartesian(endAngle);
        const largeArc = endAngle - startAngle > Math.PI ? 1 : 0;
        return `M ${cx} ${cy} L ${start.x} ${start.y} A ${radius} ${radius} 0 ${largeArc} 1 ${end.x} ${end.y} Z`;
      };
      const slices = data.filter(item => item[valueKey] > 0).map((item) => {
        const value = item[valueKey] || 0;
        const angle = (value / total) * Math.PI * 2;
        const startAngle = currentAngle;
        currentAngle += angle;
        return { ...item, path: describeArc(startAngle, currentAngle), percentage: Math.round((value / total) * 100) };
      });
      return (
        <div className="flex flex-col items-center">
          <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>
            {slices.map((item, i) => <path key={i} d={item.path} fill={item.color} stroke="#1e293b" strokeWidth="2" />)}
          </svg>
          <div className="flex flex-wrap gap-3 justify-center mt-4">
            {slices.map((item, i) => (
              <span key={i} className="flex items-center gap-1 text-sm">
                <span className="w-3 h-3 rounded" style={{ backgroundColor: item.color }}></span>
                {item[nameKey] || item.grade}: {item[valueKey]} ({item.percentage}%)
              </span>
            ))}
          </div>
        </div>
      );
    };

    const SimpleLineChart = ({ data, dataKey, xKey, color, height = 250 }) => {
      if (!data || data.length === 0) return null;
      const values = data.map(d => parseFloat(d[dataKey]) || 0);
      const maxValue = Math.max(...values, 10);
      const chartWidth = Math.max(data.length * 70 + 60, 300);
      const points = data.map((item, i) => {
        const x = 60 + i * 65;
        const y = height - 50 - ((parseFloat(item[dataKey]) || 0) / maxValue) * (height - 80);
        return { x, y, value: parseFloat(item[dataKey]) || 0 };
      });
      const pathD = points.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ');
      return (
        <div style={{ height, width: '100%', overflowX: 'auto' }}>
          <svg width={chartWidth} height={height}>
            {[0, 2, 4, 6, 8, 10].map(v => {
              const y = height - 50 - (v / maxValue) * (height - 80);
              return (<g key={v}><line x1="50" y1={y} x2={chartWidth - 10} y2={y} stroke="#475569" strokeDasharray="3,3" /><text x="40" y={y + 4} textAnchor="end" fill="#94a3b8" fontSize="11">{v}</text></g>);
            })}
            <path fill="none" stroke={color} strokeWidth="3" d={pathD} />
            {points.map((p, i) => (<g key={i}><circle cx={p.x} cy={p.y} r="5" fill={color} /><text x={p.x} y={height - 25} textAnchor="middle" fill="#94a3b8" fontSize="11">{data[i][xKey]}</text></g>))}
          </svg>
        </div>
      );
    };

    function BoulderingTracker() {
      const [boulders, setBoulders] = useState([]);
      const [view, setView] = useState('projects');
      const [focusedBoulder, setFocusedBoulder] = useState(null);
      const [projectFilter, setProjectFilter] = useState('');
      const [projectGradeFilter, setProjectGradeFilter] = useState('all');
      const [projectStatusFilter, setProjectStatusFilter] = useState('active');
      const [completedFilter, setCompletedFilter] = useState('');
      const [completedFlashFilter, setCompletedFlashFilter] = useState('all');
      const [dateRangeStart, setDateRangeStart] = useState('');
      const [dateRangeEnd, setDateRangeEnd] = useState('');
      const [showAddForm, setShowAddForm] = useState(false);
      const [sortBy, setSortBy] = useState('dateAdded');
      const [cloudEnabled, setCloudEnabled] = useState(false);
      const [cloudReady, setCloudReady] = useState(false);
      const [user, setUser] = useState(null);
      const [authReady, setAuthReady] = useState(false);
      const [authError, setAuthError] = useState('');
      const saveTimeoutRef = useRef(null);
      const cloudDbRef = useRef(null);
      const cloudLoadedRef = useRef(false);
      const cloudSaveTimeoutRef = useRef(null);
      const cloudDocPathRef = useRef(null);

      useEffect(() => {
        const saved = localStorage.getItem('mbp-boulders-v2');
        if (saved) setBoulders(JSON.parse(saved));

        if (FIREBASE_CONFIG && window.firebase?.apps) {
          const app = window.firebase.apps.length ? window.firebase.app() : window.firebase.initializeApp(FIREBASE_CONFIG);
          cloudDbRef.current = window.firebase.firestore(app);
          const auth = window.firebase.auth(app);
          auth.getRedirectResult().catch((e) => setAuthError(e.message));
          auth.onAuthStateChanged((u) => {
            setUser(u);
            if (u) {
              cloudDocPathRef.current = `boulder-tracker/users/${u.uid}`;
              cloudLoadedRef.current = false;
              setCloudEnabled(true);
            } else {
              cloudDocPathRef.current = null;
              setCloudEnabled(false);
            }
            setAuthReady(true);
            setCloudReady(true);
          });
        } else {
          setAuthReady(true);
          setCloudReady(true);
        }
      }, []);

      useEffect(() => {
        const loadCloudData = async () => {
          if (!cloudEnabled || !cloudReady || !cloudDbRef.current || cloudLoadedRef.current || !cloudDocPathRef.current) return;
          try {
            const doc = await cloudDbRef.current.doc(cloudDocPathRef.current).get();
            if (doc.exists && Array.isArray(doc.data()?.boulders)) {
              const cloudBoulders = doc.data().boulders;
              setBoulders(cloudBoulders);
              localStorage.setItem('mbp-boulders-v2', JSON.stringify(cloudBoulders));
            } else {
              const localSaved = localStorage.getItem('mbp-boulders-v2');
              if (localSaved) {
                await cloudDbRef.current.doc(cloudDocPathRef.current).set({ boulders: JSON.parse(localSaved), updatedAt: new Date().toISOString() });
              }
            }
          } catch (error) {
            setCloudEnabled(false);
          }
          cloudLoadedRef.current = true;
        };

        loadCloudData();
      }, [cloudEnabled, cloudReady]);

      useEffect(() => {
        if (saveTimeoutRef.current) clearTimeout(saveTimeoutRef.current);
        saveTimeoutRef.current = setTimeout(() => {
          localStorage.setItem('mbp-boulders-v2', JSON.stringify(boulders));
        }, 300);
        return () => clearTimeout(saveTimeoutRef.current);
      }, [boulders]);

      useEffect(() => {
        if (!cloudEnabled || !cloudDbRef.current || !cloudLoadedRef.current || !cloudDocPathRef.current) return;
        if (cloudSaveTimeoutRef.current) clearTimeout(cloudSaveTimeoutRef.current);
        cloudSaveTimeoutRef.current = setTimeout(() => {
          cloudDbRef.current.doc(cloudDocPathRef.current).set({ boulders, updatedAt: new Date().toISOString() }).catch(() => setCloudEnabled(false));
        }, 500);
        return () => clearTimeout(cloudSaveTimeoutRef.current);
      }, [boulders, cloudEnabled]);

      const addBoulder = (grade) => {
        const newBoulder = { id: Date.now(), name: '', grade, attempts: 0, completed: false, flash: false, notes: '', dateAdded: new Date().toISOString(), dateCompleted: null, sessions: [], status: 'active' };
        setBoulders([newBoulder, ...boulders]);
        setFocusedBoulder(newBoulder.id);
        setShowAddForm(false);
      };
      const updateBoulder = (id, updates) => setBoulders(boulders.map(b => b.id === id ? { ...b, ...updates } : b));
      const addAttempts = (id, attemptsToAdd) => setBoulders(boulders.map(b => b.id === id ? { ...b, attempts: b.attempts + attemptsToAdd, sessions: [...b.sessions, { date: new Date().toISOString(), attempts: attemptsToAdd }] } : b));
      const markComplete = (id, isFlash = false) => setBoulders(boulders.map(b => {
        if (b.id === id) {
          const isTrueFlash = isFlash && b.attempts === 0 && b.sessions.length === 0;
          return { ...b, completed: true, flash: isTrueFlash, attempts: isTrueFlash ? 1 : (b.attempts === 0 ? 1 : b.attempts), dateCompleted: new Date().toISOString() };
        }
        return b;
      }));
      const deleteBoulder = (id) => setBoulders(boulders.filter(b => b.id !== id));

      const signInWithGoogle = async () => {
        const provider = new window.firebase.auth.GoogleAuthProvider();
        try {
          setAuthError('');
          await window.firebase.auth().signInWithRedirect(provider);
        } catch (e) { setAuthError(e.message); }
      };
      const signOut = async () => {
        await window.firebase.auth().signOut();
        const local = localStorage.getItem('mbp-boulders-v2');
        setBoulders(local ? JSON.parse(local) : []);
      };
      const getGradeColor = (grade) => MBP_GRADES.find(g => g.grade === grade);
      const getProjectStatus = (boulder) => {
        const status = boulder.status || 'active';
        if (status === 'abandoned' || status === 'unfinished') return 'closed';
        return status;
      };
      const isClosed = (boulder) => getProjectStatus(boulder) === 'closed';
      const formatDate = (isoString) => new Date(isoString).toLocaleDateString();

      const projects = useMemo(() => boulders.filter(b => !b.completed), [boulders]);
      const completed = useMemo(() => boulders.filter(b => b.completed), [boulders]);

      const getSortedProjects = (arr) => [...arr].sort((a, b) => {
        if (sortBy === 'dateAdded') return new Date(b.dateAdded) - new Date(a.dateAdded);
        if (sortBy === 'attempts') return b.attempts - a.attempts;
        if (sortBy === 'grade') return MBP_GRADES.find(g => g.grade === b.grade).value - MBP_GRADES.find(g => g.grade === a.grade).value;
        return 0;
      });

      const filteredProjects = useMemo(() => getSortedProjects(projects.filter(b => {
        const matchesSearch = !projectFilter || (b.name && b.name.toLowerCase().includes(projectFilter.toLowerCase())) || (b.notes && b.notes.toLowerCase().includes(projectFilter.toLowerCase()));
        const matchesStatus = projectStatusFilter === 'all' || getProjectStatus(b) === projectStatusFilter;
        return matchesSearch && matchesStatus && (projectGradeFilter === 'all' || b.grade === projectGradeFilter);
      })), [projects, projectFilter, projectGradeFilter, projectStatusFilter, sortBy]);

      const filteredCompleted = useMemo(() => completed.filter(b => {
        const matchesSearch = !completedFilter || (b.name && b.name.toLowerCase().includes(completedFilter.toLowerCase())) || (b.notes && b.notes.toLowerCase().includes(completedFilter.toLowerCase()));
        const matchesFlash = completedFlashFilter === 'all' || (completedFlashFilter === 'flash' && b.flash) || (completedFlashFilter === 'send' && !b.flash);
        if (dateRangeStart && dateRangeEnd) {
          const bd = new Date(b.dateCompleted), sd = new Date(dateRangeStart), ed = new Date(dateRangeEnd);
          ed.setHours(23, 59, 59);
          return matchesSearch && matchesFlash && bd >= sd && bd <= ed;
        }
        return matchesSearch && matchesFlash;
      }).sort((a, b) => new Date(b.dateCompleted) - new Date(a.dateCompleted)), [completed, completedFilter, completedFlashFilter, dateRangeStart, dateRangeEnd]);

      const getProgressData = () => {
        const monthlyData = {};
        [...completed].sort((a, b) => new Date(a.dateCompleted) - new Date(b.dateCompleted)).forEach(boulder => {
          const date = new Date(boulder.dateCompleted);
          const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
          if (!monthlyData[monthKey]) monthlyData[monthKey] = { month: monthKey, sends: 0, flashes: 0, totalGradeValue: 0 };
          monthlyData[monthKey].sends++;
          if (boulder.flash) monthlyData[monthKey].flashes++;
          monthlyData[monthKey].totalGradeValue += MBP_GRADES.find(g => g.grade === boulder.grade).value;
        });
        return Object.values(monthlyData).map(d => ({ ...d, avgGrade: (d.totalGradeValue / d.sends).toFixed(1) }));
      };

      const getWeeklySends = () => {
        const weeklyData = {};
        completed.forEach(boulder => {
          const date = new Date(boulder.dateCompleted);
          const day = new Date(date.getFullYear(), date.getMonth(), date.getDate());
          const dayOfWeek = (day.getDay() + 6) % 7;
          day.setDate(day.getDate() - dayOfWeek);
          const weekKey = `${day.getFullYear()}-${String(day.getMonth() + 1).padStart(2, '0')}-${String(day.getDate()).padStart(2, '0')}`;
          if (!weeklyData[weekKey]) weeklyData[weekKey] = { week: weekKey, sends: 0 };
          weeklyData[weekKey].sends++;
        });
        return Object.values(weeklyData).sort((a, b) => new Date(a.week) - new Date(b.week));
      };

      const getAttemptsDistribution = () => {
        const buckets = [
          { range: '1', min: 1, max: 1 },
          { range: '2-3', min: 2, max: 3 },
          { range: '4-6', min: 4, max: 6 },
          { range: '7-9', min: 7, max: 9 },
          { range: '10+', min: 10, max: Infinity }
        ];
        return buckets.map(bucket => ({
          range: bucket.range,
          count: completed.filter(b => b.attempts >= bucket.min && b.attempts <= bucket.max).length
        })).filter(bucket => bucket.count > 0);
      };

      const getTimeToSendDistribution = () => {
        const buckets = [
          { range: '0-1d', min: 0, max: 1 },
          { range: '2-7d', min: 2, max: 7 },
          { range: '8-30d', min: 8, max: 30 },
          { range: '31+d', min: 31, max: Infinity }
        ];
        return buckets.map(bucket => ({
          range: bucket.range,
          count: completed.filter(b => {
            const start = new Date(b.dateAdded);
            const end = new Date(b.dateCompleted);
            const days = Math.max(0, Math.ceil((end - start) / (1000 * 60 * 60 * 24)));
            return days >= bucket.min && days <= bucket.max;
          }).length
        })).filter(bucket => bucket.count > 0);
      };

      const getBacklogRatio = () => [
        { name: 'Completed', value: completed.length, color: '#22c55e' },
        { name: 'Projects', value: projects.length, color: '#38bdf8' }
      ];

      const getGradeDistribution = () => MBP_GRADES.map(({ grade, color }) => {
        const gc = completed.filter(b => b.grade === grade);
        return { grade, color, sends: gc.length, flashes: gc.filter(b => b.flash).length, avgAttempts: gc.length > 0 ? (gc.reduce((s, b) => s + b.attempts, 0) / gc.length).toFixed(1) : 0 };
      }).filter(d => d.sends > 0);

      const getFlashRate = () => {
        const started = boulders.filter(b => b.completed || b.attempts > 0 || b.sessions.length > 0);
        return [
          { name: 'Flashes', value: started.filter(b => b.flash).length, color: '#eab308' },
          { name: 'Non-Flash Sends', value: started.filter(b => b.completed && !b.flash).length, color: '#3b82f6' },
          { name: 'Started (No Send)', value: started.filter(b => !b.completed).length, color: '#94a3b8' }
        ];
      };

      const stats = (() => {
        const thisMonth = new Date(); thisMonth.setDate(1); thisMonth.setHours(0, 0, 0, 0);
        return {
          totalProjects: projects.length,
          sendsThisMonth: completed.filter(b => new Date(b.dateCompleted) >= thisMonth).length,
          flashRate: (() => {
            const started = boulders.filter(b => b.completed || b.attempts > 0 || b.sessions.length > 0);
            return started.length > 0 ? Math.round((started.filter(b => b.flash).length / started.length) * 100) : 0;
          })(),
          completionRate: (() => {
            const incompleteCount = boulders.filter(b => ['paused', 'closed'].includes(getProjectStatus(b))).length;
            const trackedCount = completed.length + incompleteCount;
            return trackedCount > 0 ? Math.round((completed.length / trackedCount) * 100) : 0;
          })()
        };
      })();

      return (
        <div className="min-h-screen bg-black text-white p-4 pb-8">
          <div className="max-w-6xl mx-auto">
            <header className="text-center mb-6 pt-6">
              <button onClick={() => { setView('projects'); setFocusedBoulder(null); }} className="text-4xl font-bold mb-2 transition bg-gradient-to-r from-blue-400 via-cyan-400 to-purple-400 text-transparent bg-clip-text hover:opacity-90" type="button">Boulder Tracker</button>
              {authReady && (
                <div className="flex items-center justify-center gap-3 mb-2">
                  {user ? (
                    <>
                      {user.photoURL && <img src={user.photoURL} alt="" className="w-7 h-7 rounded-full" referrerPolicy="no-referrer" />}
                      <span className="text-sm text-slate-300">{user.displayName}</span>
                      <button onClick={signOut} className="text-xs text-slate-400 hover:text-slate-200 underline">Sign out</button>
                    </>
                  ) : (
                    FIREBASE_CONFIG && <button onClick={signInWithGoogle} className="flex items-center gap-2 bg-white text-gray-800 font-semibold text-sm px-4 py-2 rounded-full hover:bg-gray-100 transition shadow">
                      <svg width="16" height="16" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.18 1.48-4.97 2.31-8.16 2.31-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
                      Sign in with Google
                    </button>
                  )}
                </div>
              )}
              {authError && <div className="text-xs text-red-400 mb-1 px-4">{authError}</div>}
              <div className="secondary-text text-slate-400 mb-2">{cloudEnabled ? `Cloud Sync On` : user ? 'Syncing...' : 'Sign in to sync across devices'}</div>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mt-6">
                <button onClick={() => setView('projects')} className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 hover:from-slate-800/80 hover:to-slate-700/60 backdrop-blur-xl border border-white/10 rounded-lg p-3 text-left shadow-[0_8px_30px_rgba(0,0,0,0.35)] transition">
                  <div className="text-2xl font-bold text-blue-400">{stats.totalProjects}</div><div className="text-xs text-slate-400 secondary-text">Active Projects</div>
                </button>
                <button onClick={() => { setView('completed'); const t = new Date(); setDateRangeStart(new Date(t.getFullYear(), t.getMonth(), 1).toISOString().split('T')[0]); setDateRangeEnd(t.toISOString().split('T')[0]); }} className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 hover:from-slate-800/80 hover:to-slate-700/60 backdrop-blur-xl border border-white/10 rounded-lg p-3 text-left shadow-[0_8px_30px_rgba(0,0,0,0.35)] transition">
                  <div className="text-2xl font-bold text-purple-400">{stats.sendsThisMonth}</div><div className="text-xs text-slate-400 secondary-text">This Month</div>
                </button>
                <button onClick={() => { setView('completed'); setCompletedFilter(''); setCompletedFlashFilter('flash'); setDateRangeStart(''); setDateRangeEnd(''); }} className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 hover:from-slate-800/80 hover:to-slate-700/60 backdrop-blur-xl border border-white/10 rounded-lg p-3 text-left shadow-[0_8px_30px_rgba(0,0,0,0.35)] transition">
                  <div className="text-2xl font-bold text-yellow-400">{stats.flashRate}%</div><div className="text-xs text-slate-400 secondary-text">Flash Rate</div>
                </button>
                <button onClick={() => setView('stats')} className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 hover:from-slate-800/80 hover:to-slate-700/60 backdrop-blur-xl border border-white/10 rounded-lg p-3 text-left shadow-[0_8px_30px_rgba(0,0,0,0.35)] transition">
                  <div className="text-2xl font-bold text-cyan-400">{stats.completionRate}%</div><div className="text-xs text-slate-400 secondary-text">Completion</div>
                </button>
              </div>
            </header>

            <div className="flex gap-2 mb-6 flex-wrap">
              {['projects', 'completed', 'stats', 'progress'].map(v => (
                <button key={v} onClick={() => setView(v)} className={`flex-1 min-w-[120px] py-3 rounded-lg font-semibold transition ${view === v ? 'bg-blue-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}`}>
                  {v === 'projects' ? `Projects (${projects.length})` : v === 'completed' ? `Completed (${completed.length})` : v.charAt(0).toUpperCase() + v.slice(1)}
                </button>
              ))}
            </div>

            {view === 'projects' && (
              <div>
                {focusedBoulder ? (() => {
                  const boulder = boulders.find(b => b.id === focusedBoulder);
                  if (!boulder) return null;
                  const gradeInfo = getGradeColor(boulder.grade);
                  return (
                    <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 shadow-[0_10px_40px_rgba(0,0,0,0.4)] mb-6">
                      <button onClick={() => setFocusedBoulder(null)} className="text-slate-400 hover:text-slate-300 mb-4">‚Üê Back to all projects</button>
                      <div className="text-center">
                        <div style={{ backgroundColor: gradeInfo.color, color: gradeInfo.textColor }} className="inline-block px-8 py-4 rounded-xl font-bold text-3xl mb-6">{boulder.grade}</div>
                        <div className="text-6xl font-bold mb-2">{boulder.attempts}</div>
                        <div className="text-xl text-slate-400 secondary-text mb-2">attempt{boulder.attempts !== 1 ? 's' : ''}</div>
                        {boulder.sessions.length > 0 && <div className="text-sm text-slate-500 mb-6">{boulder.sessions.length} session{boulder.sessions.length !== 1 ? 's' : ''} ¬∑ Last: {formatDate(boulder.sessions[boulder.sessions.length - 1].date)}</div>}
                        <button onClick={() => addAttempts(boulder.id, 1)} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-8 rounded-2xl text-2xl mb-4 active:scale-95 shadow-lg shadow-blue-500/20 transition">+1 Attempt</button>
                        {!isClosed(boulder) && (
                          <button onClick={() => updateBoulder(boulder.id, { status: getProjectStatus(boulder) === 'active' ? 'paused' : 'active' })} className="w-full bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 rounded-xl text-lg mb-3 transition">
                            {getProjectStatus(boulder) === 'active' ? 'Pause Project' : 'Resume Project'}
                          </button>
                        )}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                          <button onClick={() => { markComplete(boulder.id, false); setFocusedBoulder(null); }} className="bg-green-600 hover:bg-green-700 px-6 py-4 rounded-xl text-lg font-semibold shadow-lg shadow-green-500/20 transition">‚úì Sent!</button>
                          <button onClick={() => { markComplete(boulder.id, true); setFocusedBoulder(null); }} disabled={boulder.attempts > 0 || boulder.sessions.length > 0} className={`px-6 py-4 rounded-xl text-lg font-semibold transition ${boulder.attempts > 0 || boulder.sessions.length > 0 ? 'bg-slate-600 text-slate-400 cursor-not-allowed' : 'bg-yellow-600 hover:bg-yellow-700 shadow-lg shadow-yellow-500/20'}`}>‚ö° Flash!</button>
                          <button onClick={() => updateBoulder(boulder.id, { status: isClosed(boulder) ? 'active' : 'closed' })} className={`px-6 py-4 rounded-xl text-lg font-semibold transition ${isClosed(boulder) ? 'bg-blue-600 hover:bg-blue-700 text-white shadow-lg shadow-blue-500/20' : 'bg-rose-600 hover:bg-rose-700 text-white shadow-lg shadow-rose-500/20'}`}>
                            {isClosed(boulder) ? 'Reopen Project' : 'Will Not Finish'}
                          </button>
                        </div>
                        {boulder.sessions.length > 0 && (
                          <details className="mb-6 text-left"><summary className="cursor-pointer text-blue-400 hover:text-blue-300 mb-2 text-sm font-semibold">View Session History</summary>
                            <div className="bg-slate-700 rounded-lg p-3 space-y-2">{boulder.sessions.map((s, idx) => <div key={idx} className="flex justify-between text-sm"><span className="text-slate-300">{formatDate(s.date)}</span><span className="text-slate-400 secondary-text">+{s.attempts} attempt{s.attempts !== 1 ? 's' : ''}</span></div>)}</div>
                          </details>
                        )}
                        <input type="text" value={boulder.name} onChange={(e) => updateBoulder(boulder.id, { name: e.target.value })} placeholder="Name (optional)" className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white text-center text-lg mb-3 focus:border-blue-500 focus:outline-none placeholder:text-slate-500" />
                        <textarea value={boulder.notes} onChange={(e) => updateBoulder(boulder.id, { notes: e.target.value })} placeholder="Notes: beta, location, observations..." className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white mb-4 h-20 focus:border-blue-500 focus:outline-none placeholder:text-slate-500" />
                        <button onClick={() => { if (confirm('Delete this project?')) { deleteBoulder(boulder.id); setFocusedBoulder(null); } }} className="text-red-400 hover:text-red-300 py-2 mx-auto flex items-center gap-2">üóëÔ∏è Delete Project</button>
                      </div>
                    </div>
                  );
                })() : (
                  <>
                    {!showAddForm ? <button onClick={() => setShowAddForm(true)} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl mb-6">+ Add New Project</button> : (
                      <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 shadow-[0_10px_40px_rgba(0,0,0,0.4)] mb-6">
                        <div className="flex justify-between items-center mb-4"><h2 className="text-xl font-bold">Select Grade</h2><button onClick={() => setShowAddForm(false)} className="text-slate-400 hover:text-slate-300 text-2xl">‚úï</button></div>
                        <div className="grid grid-cols-3 gap-2">{MBP_GRADES.map(({ grade, color, textColor }) => <button key={grade} onClick={() => addBoulder(grade)} style={{ backgroundColor: color, color: textColor }} className="py-4 rounded-lg font-bold hover:scale-105 transition">{grade}</button>)}</div>
                      </div>
                    )}
                    <div className="flex flex-wrap gap-2 mb-4">
                      {[
                        { label: 'Active', value: 'active' },
                        { label: 'Paused', value: 'paused' },
                        { label: 'Closed', value: 'closed' },
                        { label: 'All', value: 'all' }
                      ].map(option => (
                        <button key={option.value} onClick={() => setProjectStatusFilter(option.value)} className={`px-3 py-1.5 rounded-full text-sm font-semibold transition ${projectStatusFilter === option.value ? 'bg-blue-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}`}>
                          {option.label}
                        </button>
                      ))}
                    </div>
                    {filteredProjects.length > 0 && (
                      <details className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl mb-4 shadow-[0_10px_40px_rgba(0,0,0,0.3)]"><summary className="cursor-pointer p-4 text-sm font-semibold text-slate-300 hover:text-white">Filters & Sort</summary>
                        <div className="px-4 pb-4 space-y-3">
                          <input type="text" placeholder="Search..." value={projectFilter} onChange={(e) => setProjectFilter(e.target.value)} className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:border-blue-500 focus:outline-none" />
                          <select value={projectGradeFilter} onChange={(e) => setProjectGradeFilter(e.target.value)} className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"><option value="all">All Grades</option>{MBP_GRADES.map(({ grade }) => <option key={grade} value={grade}>{grade}</option>)}</select>
                          <select value={projectStatusFilter} onChange={(e) => setProjectStatusFilter(e.target.value)} className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"><option value="all">All Statuses</option><option value="active">Active</option><option value="paused">Paused</option><option value="closed">Closed</option></select>
                          <select value={sortBy} onChange={(e) => setSortBy(e.target.value)} className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"><option value="dateAdded">Date Added</option><option value="attempts">Most Attempts</option><option value="grade">Hardest First</option></select>
                        </div>
                      </details>
                    )}
                    <h2 className="text-2xl font-bold mb-4">
                      {projectStatusFilter === 'closed' ? 'Closed Projects' : projectStatusFilter === 'paused' ? 'Paused Projects' : projectStatusFilter === 'all' ? 'All Projects' : 'Active Projects'}
                    </h2>
                    <div className="space-y-3">
                      {filteredProjects.length === 0 ? <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-8 text-center text-slate-400 secondary-text shadow-[0_10px_40px_rgba(0,0,0,0.3)]">{projectFilter || projectGradeFilter !== 'all' || projectStatusFilter !== 'active' ? 'No projects match.' : 'No active projects. Add one above!'}</div> : filteredProjects.map(boulder => {
                        const gradeInfo = getGradeColor(boulder.grade);
                        return (
                          <div key={boulder.id} className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-4 shadow-[0_10px_35px_rgba(0,0,0,0.3)] cursor-pointer hover:from-slate-800/80 hover:to-slate-700/60 transition" onClick={() => setFocusedBoulder(boulder.id)}>
                            <div className="flex items-start gap-4">
                              <div style={{ backgroundColor: gradeInfo.color, color: gradeInfo.textColor }} className="px-4 py-2 rounded-lg font-bold text-lg shrink-0">{boulder.grade}</div>
                              <div className="flex-1">
                                <div className="flex items-center gap-2 mb-2">
                                  {boulder.name && <div className="font-bold text-lg">{boulder.name}</div>}
                                <span className={`text-xs px-2 py-0.5 rounded-full ${getProjectStatus(boulder) === 'active' ? 'bg-green-500/20 text-green-300' : getProjectStatus(boulder) === 'paused' ? 'bg-yellow-500/20 text-yellow-300' : 'bg-rose-500/20 text-rose-300'}`}>{getProjectStatus(boulder) === 'active' ? 'Active' : getProjectStatus(boulder) === 'paused' ? 'Paused' : 'Closed'}</span>
                                </div>
                                <div className="font-semibold text-slate-300 mb-2">{boulder.attempts} attempt{boulder.attempts !== 1 ? 's' : ''}</div>
                                {boulder.notes && <div className="text-sm text-slate-300 mb-2 line-clamp-2">{boulder.notes}</div>}
                                <div className="text-xs text-slate-400 secondary-text">Added {formatDate(boulder.dateAdded)}</div>
                              </div>
                              <div className="flex flex-col items-end gap-2 shrink-0">
                                {!isClosed(boulder) ? (
                                  <button onClick={(e) => { e.stopPropagation(); updateBoulder(boulder.id, { status: getProjectStatus(boulder) === 'active' ? 'paused' : 'active' }); }} className="text-xs px-2 py-1 rounded-full bg-slate-700 hover:bg-slate-600 text-slate-200">
                                    {getProjectStatus(boulder) === 'active' ? 'Pause' : 'Resume'}
                                  </button>
                                ) : (
                                  <button onClick={(e) => { e.stopPropagation(); updateBoulder(boulder.id, { status: 'active' }); }} className="text-xs px-2 py-1 rounded-full bg-blue-600 hover:bg-blue-500 text-white">
                                    Reopen
                                  </button>
                                )}
                                <button onClick={(e) => { e.stopPropagation(); updateBoulder(boulder.id, { status: isClosed(boulder) ? 'active' : 'closed' }); }} className={`text-xs px-2 py-1 rounded-full ${isClosed(boulder) ? 'bg-slate-700 hover:bg-slate-600 text-slate-200' : 'bg-rose-600 hover:bg-rose-500 text-white'}`}>
                                  {isClosed(boulder) ? 'Restore' : 'Close'}
                                </button>
                                <div className="text-slate-400 secondary-text">‚Üí</div>
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </>
                )}
              </div>
            )}

            {view === 'completed' && (
              <div className="space-y-3">
                <h2 className="text-2xl font-bold mb-4">Completed Sends</h2>
                {completed.length > 0 && (
                  <details className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl mb-4 shadow-[0_10px_40px_rgba(0,0,0,0.3)]"><summary className="cursor-pointer p-4 text-sm font-semibold text-slate-300 hover:text-white">Filters</summary>
                    <div className="px-4 pb-4 space-y-3">
                      <input type="text" placeholder="Search..." value={completedFilter} onChange={(e) => setCompletedFilter(e.target.value)} className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:border-blue-500 focus:outline-none" />
                      <select value={completedFlashFilter} onChange={(e) => setCompletedFlashFilter(e.target.value)} className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"><option value="all">All Sends</option><option value="flash">Flashes Only</option><option value="send">Regular Sends</option></select>
                      <div className="grid grid-cols-2 gap-3">
                        <input type="date" value={dateRangeStart} onChange={(e) => setDateRangeStart(e.target.value)} className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:border-blue-500 focus:outline-none" />
                        <input type="date" value={dateRangeEnd} onChange={(e) => setDateRangeEnd(e.target.value)} className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:border-blue-500 focus:outline-none" />
                      </div>
                      {(dateRangeStart || dateRangeEnd || completedFilter || completedFlashFilter !== 'all') && <button onClick={() => { setDateRangeStart(''); setDateRangeEnd(''); setCompletedFilter(''); setCompletedFlashFilter('all'); }} className="text-sm text-blue-400 hover:text-blue-300">Clear filters</button>}
                    </div>
                  </details>
                )}
                {filteredCompleted.length === 0 ? <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-8 text-center text-slate-400 secondary-text shadow-[0_10px_40px_rgba(0,0,0,0.3)]">{completedFilter || dateRangeStart || dateRangeEnd || completedFlashFilter !== 'all' ? 'No sends match.' : 'No completed sends yet!'}</div> : filteredCompleted.map(boulder => {
                  const gradeInfo = getGradeColor(boulder.grade);
                  return (
                    <div key={boulder.id} className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-4 shadow-[0_10px_35px_rgba(0,0,0,0.3)]">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-4 flex-1">
                          <div style={{ backgroundColor: gradeInfo.color, color: gradeInfo.textColor }} className="px-4 py-2 rounded-lg font-bold text-lg">{boulder.grade}</div>
                          <div className="flex-1">
                            <div className="font-semibold flex items-center gap-2 flex-wrap">
                              {boulder.name && <><span className="text-lg">{boulder.name}</span><span className="text-slate-400">¬∑</span></>}
                              <span className={boulder.flash ? 'text-yellow-400' : 'text-green-400'}>{boulder.flash ? '‚ö° Flash!' : `‚úì ${boulder.attempts} attempt${boulder.attempts !== 1 ? 's' : ''}`}</span>
                            </div>
                            <div className="text-sm text-slate-400 secondary-text">{formatDate(boulder.dateCompleted)}</div>
                            {boulder.notes && <div className="text-sm text-slate-300 mt-1">{boulder.notes}</div>}
                          </div>
                        </div>
                        <button onClick={(e) => { e.stopPropagation(); if (confirm('Delete this send?')) deleteBoulder(boulder.id); }} className="text-red-400 hover:text-red-300 p-2">üóëÔ∏è</button>
                      </div>
                    </div>
                  );
                })}
              </div>
            )}

            {view === 'stats' && (
              <div>
                <h2 className="text-2xl font-bold mb-6">üìà Statistics</h2>
                {completed.length === 0 ? <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-8 text-center text-slate-400 secondary-text shadow-[0_10px_40px_rgba(0,0,0,0.3)]">No completed sends yet!</div> : (
                  <div className="space-y-6">
                    <div className="grid grid-cols-2 gap-4">
                      <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 text-center shadow-[0_10px_40px_rgba(0,0,0,0.3)]"><div className="text-4xl font-bold text-blue-400">{completed.length}</div><div className="text-slate-400 secondary-text mt-2">Total Sends</div></div>
                      <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 text-center shadow-[0_10px_40px_rgba(0,0,0,0.3)]"><div className="text-4xl font-bold text-yellow-400">{completed.filter(b => b.flash).length}</div><div className="text-slate-400 secondary-text mt-2">Flashes</div></div>
                    </div>
                    <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 shadow-[0_10px_40px_rgba(0,0,0,0.3)]"><h3 className="text-xl font-bold mb-4">Flash Rate</h3><SimplePieChart data={getFlashRate()} nameKey="name" valueKey="value" /></div>
                    <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 shadow-[0_10px_40px_rgba(0,0,0,0.3)]"><h3 className="text-xl font-bold mb-4">Completed vs Projects</h3><SimplePieChart data={getBacklogRatio()} nameKey="name" valueKey="value" /></div>
                    <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 shadow-[0_10px_40px_rgba(0,0,0,0.3)]"><h3 className="text-xl font-bold mb-4">Distribution by Grade</h3><SimplePieChart data={getGradeDistribution()} nameKey="grade" valueKey="sends" /></div>
                    <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 shadow-[0_10px_40px_rgba(0,0,0,0.3)]"><h3 className="text-xl font-bold mb-4">Average Attempts by Grade</h3><SimpleBarChart data={getGradeDistribution()} dataKey="avgAttempts" xKey="grade" colors={['#f59e0b']} /></div>
                    <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 shadow-[0_10px_40px_rgba(0,0,0,0.3)]"><h3 className="text-xl font-bold mb-4">Attempts Distribution</h3><SimpleBarChart data={getAttemptsDistribution()} dataKey="count" xKey="range" colors={['#38bdf8']} /></div>
                    <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 shadow-[0_10px_40px_rgba(0,0,0,0.3)]"><h3 className="text-xl font-bold mb-4">Time to Send</h3><SimpleBarChart data={getTimeToSendDistribution()} dataKey="count" xKey="range" colors={['#f97316']} /></div>
                    <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 shadow-[0_10px_40px_rgba(0,0,0,0.3)]"><h3 className="text-xl font-bold mb-4">Weekly Sends</h3><SimpleBarChart data={getWeeklySends()} dataKey="sends" xKey="week" colors={['#22c55e']} /></div>
                    <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 shadow-[0_10px_40px_rgba(0,0,0,0.3)]"><h3 className="text-xl font-bold mb-4">Grade Progression</h3><SimpleLineChart data={getProgressData()} dataKey="avgGrade" xKey="month" color="#38bdf8" /></div>
                    <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 shadow-[0_10px_40px_rgba(0,0,0,0.3)]">
                      <h3 className="text-xl font-bold mb-4">Detailed Statistics by Grade</h3>
                      <div className="grid gap-3">{getGradeDistribution().map(stat => {
                        const gradeInfo = getGradeColor(stat.grade);
                        return (
                          <div key={stat.grade} className="bg-slate-900/70 backdrop-blur-xl border border-white/10 rounded-xl p-4 flex items-center gap-4 shadow-[0_10px_35px_rgba(0,0,0,0.25)]">
                            <div style={{ backgroundColor: gradeInfo.color, color: gradeInfo.textColor }} className="px-4 py-2 rounded-lg font-bold text-lg">{stat.grade}</div>
                            <div className="flex-1 grid grid-cols-3 gap-4 text-sm">
                              <div><div className="text-slate-400 secondary-text">Sends</div><div className="font-bold text-lg">{stat.sends}</div></div>
                              <div><div className="text-slate-400 secondary-text">Flashes</div><div className="font-bold text-lg">{stat.flashes}</div></div>
                              <div><div className="text-slate-400 secondary-text">Avg Attempts</div><div className="font-bold text-lg">{stat.avgAttempts}</div></div>
                            </div>
                          </div>
                        );
                      })}</div>
                    </div>
                  </div>
                )}
              </div>
            )}

            {view === 'progress' && (
              <div className="space-y-6">
                <h2 className="text-2xl font-bold mb-4">Progress Over Time</h2>
                {completed.length === 0 ? <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-8 text-center text-slate-400 secondary-text shadow-[0_10px_40px_rgba(0,0,0,0.3)]">Complete some boulders to see progress!</div> : (
                  <>
                    <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 shadow-[0_10px_40px_rgba(0,0,0,0.3)]"><h3 className="text-xl font-bold mb-4">Monthly Sends</h3><SimpleBarChart data={getProgressData()} dataKey="sends" secondaryKey="flashes" xKey="month" colors={['#3b82f6', '#eab308']} /></div>
                    <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 shadow-[0_10px_40px_rgba(0,0,0,0.3)]"><h3 className="text-xl font-bold mb-4">Average Grade Over Time</h3><SimpleLineChart data={getProgressData()} dataKey="avgGrade" xKey="month" color="#10b981" /></div>
                    <div className="bg-gradient-to-br from-slate-900/80 to-slate-800/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 shadow-[0_10px_40px_rgba(0,0,0,0.3)]"><h3 className="text-xl font-bold mb-4">Sends by Grade</h3><SimpleBarChart data={getGradeDistribution()} dataKey="sends" secondaryKey="flashes" xKey="grade" colors={['#8b5cf6', '#eab308']} /></div>
                  </>
                )}
              </div>
            )}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<BoulderingTracker />);
  </script>
</body>
</html>
